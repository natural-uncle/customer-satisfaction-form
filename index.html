<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>è‡ªç„¶å¤§å”æ¸…æ´—æœå‹™ï½œé¡§å®¢æ»¿æ„åº¦èª¿æŸ¥</title>

<style>
/* ä¸»è¦æ¨£å¼ï¼ˆç²¾ç°¡ç‰ˆï¼Œä¿ç•™ä½ çš„è¦–è¦ºé¢¨æ ¼ï¼‰ */
body{font-family:"Microsoft JhengHei",sans-serif;background:#f9faf9;color:#333;margin:0}
.container{max-width:800px;margin:20px auto;background:#fff;padding:20px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.1)}
h2{text-align:center;color:#3a6d4f;margin:10px 0;font-size:2rem}
.form-group{margin-bottom:20px}
label{font-weight:bold;display:block;margin-bottom:8px;color:#3a6d4f;font-size:1.1rem}
.options label{display:block;margin:5px 0}
textarea,input[type=text]{width:100%;box-sizing:border-box;padding:14px;border:1px solid #ccc;border-radius:8px;font-size:1rem;resize:vertical;margin-top:8px}
input[type=range]{width:100%}
button{background:#3a6d4f;color:#fff;border:0;padding:14px 20px;font-size:1.1rem;border-radius:8px;cursor:pointer;display:block;margin:0 auto}
button:hover{background:#2d523c}
.progress-container{background:#e0e0e0;border-radius:20px;margin:20px 0;height:20px;width:100%;overflow:hidden}
.progress-bar{height:100%;background:#3a6d4f;width:0%;transition:width .3s ease}
#loadingBackdrop{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.4);z-index:9999}
#loadingBackdrop.show{display:flex}
.loading-card{background:#fff;padding:16px 20px;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,.2);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
.spinner{width:18px;height:18px;border:3px solid #ddd;border-top-color:#888;border-radius:50%;display:inline-block;animation:spin 1s linear infinite;margin-right:8px;vertical-align:-3px}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>
<body>

<div class="container">
  <h2>èª æ‘¯é‚€è«‹æ‚¨å¡«å¯«æ»¿æ„åº¦èª¿æŸ¥</h2>

  <div class="progress-container"><div class="progress-bar" id="progressBar"></div></div>

  <form id="surveyForm" method="POST" action="/api/submit">
    <div class="form-group">
      <label>ğŸ‘¤ è«‹ç•™ä¸‹æ‚¨çš„å§“åæˆ– LINE ID</label>
      <input type="text" name="customer_name" placeholder="è¼¸å…¥å§“åæˆ– LINE ID"/>
    </div>

    <div class="form-group">
      <label>1. æ‚¨å°é€™æ¬¡çš„æ¸…æ´—æœå‹™æ•´é«”é«”é©—æ„Ÿè¦ºå¦‚ä½•ï¼Ÿ</label>
      <div class="options">
        <label><input type="radio" name="q1" value="éå¸¸æ»¿æ„"/> éå¸¸æ»¿æ„</label>
        <label><input type="radio" name="q1" value="æ»¿æ„"/> æ»¿æ„</label>
        <label><input type="radio" name="q1" value="æ™®é€š"/> æ™®é€š</label>
        <label><input type="radio" name="q1" value="ä¸å¤ªæ»¿æ„"/> ä¸å¤ªæ»¿æ„</label>
        <label><input type="radio" name="q1" value="éå¸¸ä¸æ»¿æ„"/> éå¸¸ä¸æ»¿æ„</label>
      </div>
    </div>

    <div class="form-group">
      <label>2. æ‚¨å°æœå‹™äººå“¡çš„å°ˆæ¥­ç¨‹åº¦æ˜¯å¦æ»¿æ„ï¼Ÿ</label>
      <div class="options">
        <label><input type="radio" name="q2" value="éå¸¸æ»¿æ„"/> éå¸¸æ»¿æ„</label>
        <label><input type="radio" name="q2" value="æ»¿æ„"/> æ»¿æ„</label>
        <label><input type="radio" name="q2" value="æ™®é€š"/> æ™®é€š</label>
        <label><input type="radio" name="q2" value="ä¸å¤ªæ»¿æ„"/> ä¸å¤ªæ»¿æ„</label>
        <label><input type="radio" name="q2" value="éå¸¸ä¸æ»¿æ„"/> éå¸¸ä¸æ»¿æ„</label>
      </div>
      <textarea name="q2_extra" placeholder="è‹¥æœ‰ç‰¹åˆ¥å°è±¡æˆ–å»ºè­°ï¼Œè«‹å¡«å¯«..."></textarea>
    </div>

    <div class="form-group">
      <label>3. æ‚¨èªç‚ºæœå‹™äººå“¡çš„æ•´é«”è¡¨ç¾å¦‚ä½•ï¼Ÿï¼ˆ1=éå¸¸ä¸æ»¿æ„ï¼Œ5=éå¸¸æ»¿æ„ï¼‰</label>
      <div class="options">
        <label><input type="radio" name="q3" value="1"/> 1 åˆ†</label>
        <label><input type="radio" name="q3" value="2"/> 2 åˆ†</label>
        <label><input type="radio" name="q3" value="3"/> 3 åˆ†</label>
        <label><input type="radio" name="q3" value="4"/> 4 åˆ†</label>
        <label><input type="radio" name="q3" value="5"/> 5 åˆ†</label>
      </div>
    </div>

    <div class="form-group">
      <label>4. è‹¥æœ‹å‹æˆ–åŒäº‹æœ‰éœ€è¦ï¼Œæ‚¨é¡˜æ„æ¨è–¦è‡ªç„¶å¤§å”çš„æ¸…æ´—æœå‹™å—ï¼Ÿï¼ˆ1=å®Œå…¨ä¸æœƒæ¨è–¦ï¼Œ10=ä¸€å®šæœƒæ¨è–¦ï¼‰</label>
      <input type="range" name="q4" min="1" max="10" value="5" oninput="this.nextElementSibling.value=this.value"/>
      <output>5</output>
    </div>

    <div class="form-group">
      <label>5. æœªä¾†æ˜¯å¦æœƒå†æ¬¡å§”è¨—è‡ªç„¶å¤§å”é€²è¡Œå®¶é›»æ¸…æ´—æœå‹™ï¼Ÿ</label>
      <div class="options">
        <label><input type="radio" name="q5" value="ä¸€å®šæœƒ"/> ä¸€å®šæœƒ</label>
        <label><input type="radio" name="q5" value="æœ‰éœ€è¦æœƒè€ƒæ…®"/> æœ‰éœ€è¦æœƒè€ƒæ…®</label>
        <label><input type="radio" name="q5" value="å¯èƒ½ä¸æœƒ"/> å¯èƒ½ä¸æœƒ</label>
        <label><input type="radio" name="q5" value="ä¸æœƒ"/> ä¸æœƒ</label>
      </div>
    </div>

    <div class="form-group">
      <label>6. æ‚¨å°æˆ‘å€‘çš„æœå‹™æœ‰ä»»ä½•æƒ³æ³•ã€é¼“å‹µæˆ–å»ºè­°å—ï¼Ÿ</label>
      <textarea name="q6" placeholder="ğŸ“ è«‹è‡ªç”±å¡«å¯«æ‚¨çš„å»ºè­°..."></textarea>
    </div>

    <button type="submit">é€å‡ºè¡¨å–®</button>
  </form>
</div>

<div id="loadingBackdrop"><div class="loading-card"><span class="spinner"></span>è³‡æ–™é€å‡ºä¸­ï¼Œè«‹ç¨å€™â€¦</div></div>

<script>
// é€²åº¦æ¢ï¼ˆç°¡ç‰ˆï¼‰
(function(){
  var form=document.getElementById("surveyForm");
  var bar=document.getElementById("progressBar");
  function update(){
    var answered=0,total=7;
    form.querySelectorAll("input,textarea").forEach(function(el){
      if((el.type==="radio"&&el.checked)||(el.type==="text"&&el.value.trim()!=="")||(el.type==="range"&&el.value)||(el.tagName==="TEXTAREA"&&el.value.trim()!=="")) answered++;
    });
    bar.style.width=Math.min(answered/total*100,100)+"%";
  }
  form.addEventListener("input",update);
})();

// æäº¤ï¼ˆfetch â†’ /api/submitï¼›ä»»ä½• 2xx è¦–ç‚ºæˆåŠŸï¼‰
(function(){
  var form=document.getElementById("surveyForm");
  var backdrop=document.getElementById("loadingBackdrop");
  var submitBtn=form.querySelector('[type="submit"]');

  function showLoading(b){backdrop.classList[b?"add":"remove"]("show");}
  function setSubmitting(b){
    if(!submitBtn) return;
    submitBtn.disabled=!!b;
    submitBtn.textContent = b ? "é€å‡ºä¸­â€¦" : "é€å‡ºè¡¨å–®";
  }

  form.addEventListener("submit",function(e){
    e.preventDefault();

    var fd=new FormData(form);
    var payload={};
    fd.forEach(function(v,k){
      if(payload[k]!==undefined) payload[k]=[].concat(payload[k],v);
      else payload[k]=v;
    });
    payload.userAgent=navigator.userAgent;
    payload.submittedAt=new Date().toISOString();

    setSubmitting(true); showLoading(true);

    fetch("/api/submit",{
      method:"POST",
      headers:{ "content-type":"application/json" },
      body:JSON.stringify(payload)
    })
    .then(async function(res){
      if(res.ok) return {ok:true};
      var txt=""; try{ txt=await res.text(); }catch(e){}
      throw new Error("HTTP "+res.status+(txt?(": "+txt):""));
    })
    .then(function(){
      window.location.href="thankyou.html";
    })
    .catch(function(err){
      if (confirm("é€å‡ºå¯èƒ½æˆåŠŸï¼Œä½†å›æ‡‰æ ¼å¼ç•°å¸¸ã€‚\nè¦å‰å¾€å®Œæˆé å—ï¼Ÿ\n\nè©³ç´°ï¼š"+(err&&err.message?err.message:err))) {
        window.location.href="thankyou.html";
        return;
      }
      alert("é€å‡ºå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚\nåŸå› ï¼š"+(err&&err.message?err.message:err));
    })
    .finally(function(){ setSubmitting(false); showLoading(false); });
  },{once:true});
})();
</script>
</body>
</html>
