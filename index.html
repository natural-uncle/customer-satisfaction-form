<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>自然大叔清洗服務｜顧客滿意度調查</title>

<style>
/* === 主要樣式（保留你原本的設計） === */
body{font-family:"Microsoft JhengHei",sans-serif;background:#f9faf9;color:#333;margin:0}
.container{max-width:800px;margin:20px auto;background:#fff;padding:20px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.1)}
.logo{text-align:center;margin-bottom:20px}
.logo img{max-width:100%;border-radius:12px}
h2{text-align:center;color:#3a6d4f;margin:10px 0;font-size:2rem}
p{line-height:1.7;color:#555;font-size:1.05rem}
.form-group{margin-bottom:20px}
label{font-weight:bold;display:block;margin-bottom:8px;color:#3a6d4f;font-size:1.1rem}
.options label{display:block;margin:5px 0}
textarea,input[type=text]{width:100%;box-sizing:border-box;padding:14px;border:1px solid #ccc;border-radius:8px;font-size:1rem;resize:vertical;margin-top:8px}
input[type=range]{width:100%}
button{background:#3a6d4f;color:#fff;border:0;padding:14px 20px;font-size:1.1rem;border-radius:8px;cursor:pointer;display:block;margin:0 auto}
button:hover{background:#2d523c}
.contact{margin-top:30px;padding:20px;background:#f1f9f1;border-radius:8px;font-size:1rem;text-align:center}
.footer{text-align:center;margin-top:40px;font-size:.95rem;color:#777}
.progress-container{background:#e0e0e0;border-radius:20px;margin:20px 0;height:20px;width:100%;overflow:hidden}
.progress-bar{height:100%;background:#3a6d4f;width:0%;transition:width .3s ease}
.theme-toggle{position:fixed;top:15px;right:15px;background:#3a6d4f;color:#fff;border:0;border-radius:50%;width:42px;height:42px;cursor:pointer;font-size:18px}
body.dark{background:#121212;color:#eee}
body.dark .container{background:#1e1e1e;box-shadow:0 4px 12px rgba(0,0,0,.6)}
body.dark h2,body.dark label{color:#9ad0b1}
body.dark p{color:#ccc}
body.dark textarea,body.dark input[type=text],body.dark input[type=range]{background:#2a2a2a;color:#eee;border:1px solid #555}
body.dark button{background:#4da67a}
body.dark button:hover{background:#3b7e5b}
body.dark .progress-container{background:#333}
body.dark .progress-bar{background:#4da67a}
body.dark .contact{background:#2a2a2a;color:#ccc}
body.dark .footer{color:#aaa}
@media (max-width:600px){
  .container{margin:10px;padding:18px;border-radius:10px}
  h2{font-size:1.5rem}
  p,label{font-size:1.05rem;line-height:1.6}
  input[type=text],textarea{font-size:1.05rem;padding:14px}
  button{width:100%;padding:16px;font-size:1.15rem}
}
#loadingBackdrop{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.4);z-index:9999}
#loadingBackdrop.show{display:flex}
.loading-card{background:#fff;padding:16px 20px;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,.2);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
.spinner{width:18px;height:18px;border:3px solid #ddd;border-top-color:#888;border-radius:50%;display:inline-block;animation:spin 1s linear infinite;margin-right:8px;vertical-align:-3px}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>
<body>
<button class="theme-toggle" id="themeToggle">🌙</button>

<div class="container">
  <div class="logo"><img src="ChatGPT.png" alt="自然大叔清洗服務 顧客滿意度調查"/></div>
  <h2>誠摯邀請您填寫滿意度調查</h2>
  <p>感謝您選擇 <b>自然大叔專業家電清洗服務</b>！我們致力提供安心、放心的清洗體驗。</p>

  <div class="progress-container"><div class="progress-bar" id="progressBar"></div></div>

  <form id="surveyForm" method="POST" action="/api/submit">
    <div class="form-group">
      <label>👤 請留下您的姓名或 LINE ID</label>
      <input type="text" name="customer_name" placeholder="輸入姓名或 LINE ID"/>
    </div>

    <div class="form-group">
      <label>1. 您對這次的清洗服務整體體驗感覺如何？</label>
      <div class="options">
        <label><input type="radio" name="q1" value="非常滿意"/> 非常滿意</label>
        <label><input type="radio" name="q1" value="滿意"/> 滿意</label>
        <label><input type="radio" name="q1" value="普通"/> 普通</label>
        <label><input type="radio" name="q1" value="不太滿意"/> 不太滿意</label>
        <label><input type="radio" name="q1" value="非常不滿意"/> 非常不滿意</label>
      </div>
    </div>

    <div class="form-group">
      <label>2. 您對服務人員的專業程度是否滿意？</label>
      <div class="options">
        <label><input type="radio" name="q2" value="非常滿意"/> 非常滿意</label>
        <label><input type="radio" name="q2" value="滿意"/> 滿意</label>
        <label><input type="radio" name="q2" value="普通"/> 普通</label>
        <label><input type="radio" name="q2" value="不太滿意"/> 不太滿意</label>
        <label><input type="radio" name="q2" value="非常不滿意"/> 非常不滿意</label>
      </div>
      <textarea name="q2_extra" placeholder="若有特別印象或建議，請填寫..."></textarea>
    </div>

    <div class="form-group">
      <label>3. 您認為服務人員的整體表現如何？</label>
      <div class="note">（1分=非常不滿意，5分=非常滿意）</div>
      <div class="options">
        <label><input type="radio" name="q3" value="1"/> 1 分</label>
        <label><input type="radio" name="q3" value="2"/> 2 分</label>
        <label><input type="radio" name="q3" value="3"/> 3 分</label>
        <label><input type="radio" name="q3" value="4"/> 4 分</label>
        <label><input type="radio" name="q3" value="5"/> 5 分</label>
      </div>
    </div>

    <div class="form-group">
      <label>4. 若朋友或同事有需要，您願意推薦自然大叔的清洗服務嗎？</label>
      <div class="note">（1分=完全不會推薦，10分=一定會推薦）</div>
      <input type="range" name="q4" min="1" max="10" value="5" oninput="this.nextElementSibling.value=this.value"/>
      <output>5</output>
    </div>

    <div class="form-group">
      <label>5. 未來是否會再次委託自然大叔進行家電清洗服務？</label>
      <div class="options">
        <label><input type="radio" name="q5" value="一定會"/> 一定會</label>
        <label><input type="radio" name="q5" value="有需要會考慮"/> 有需要會考慮</label>
        <label><input type="radio" name="q5" value="可能不會"/> 可能不會</label>
        <label><input type="radio" name="q5" value="不會"/> 不會</label>
      </div>
    </div>

    <div class="form-group">
      <label>6. 您對我們的服務有任何想法、鼓勵或建議嗎？</label>
      <textarea name="q6" placeholder="📝 請自由填寫您的建議..."></textarea>
    </div>

    <button type="submit">送出表單</button>
    <div class="thankyou" aria-live="polite">✅ 感謝您填寫調查表！即將跳轉...</div>
  </form>

  <div class="contact">
    <h3>📱 聯絡我們｜自然大叔</h3>
    <a class="btn btn-line" href="https://lin.ee/OHk6Rn7">🟢 LINE 官方帳號</a>
    <a class="btn btn-fb" href="https://www.facebook.com/naturaluncle">🔵 Facebook 粉絲專頁</a>
  </div>
  <div class="footer">© 2025 自然大叔｜專業家電清洗服務</div>
</div>

<div id="loadingBackdrop"><div class="loading-card"><span class="spinner"></span>資料送出中，請稍候…</div></div>

<script>
// 進度條
(function(){
  var form=document.getElementById("surveyForm");
  var progressBar=document.getElementById("progressBar");
  function update(){
    var answered=0,total=7;
    form.querySelectorAll("input,textarea").forEach(function(el){
      if((el.type==="radio"&&el.checked)||(el.type==="text"&&el.value.trim()!=="")||(el.type==="range"&&el.value)||(el.tagName==="TEXTAREA"&&el.value.trim()!=="")) answered++;
    });
    progressBar.style.width=Math.min(answered/total*100,100)+"%";
  }
  form.addEventListener("input",update);
})();

// 主題切換
(function(){
  var btn=document.getElementById("themeToggle");
  function setTheme(t){document.body.classList.toggle("dark",t==="dark");btn.textContent=t==="dark"?"☀️":"🌙";localStorage.setItem("theme",t);}
  btn.addEventListener("click",function(){setTheme(document.body.classList.contains("dark")?"light":"dark");});
  var saved=localStorage.getItem("theme");
  setTheme(saved?saved:(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"));
})();

// 提交（fetch → /api/submit；任何 2xx 視為成功）
(function(){
  var form=document.getElementById("surveyForm");
  var thankyou=document.querySelector(".thankyou");
  var backdrop=document.getElementById("loadingBackdrop");
  var submitBtn=form.querySelector('[type="submit"]');

  function showLoading(b){backdrop.classList[b?"add":"remove"]("show");}
  function setSubmitting(b){
    if(!submitBtn) return;
    submitBtn.disabled=!!b;
    if(b){
      if(!submitBtn.dataset.origtxt) submitBtn.dataset.origtxt=submitBtn.textContent.trim();
      submitBtn.textContent="送出中…";
    }else{
      if(submitBtn.dataset.origtxt) submitBtn.textContent=submitBtn.dataset.origtxt;
    }
  }

  form.addEventListener("submit",function(e){
    e.preventDefault();

    var fd=new FormData(form);
    var payload={};
    fd.forEach(function(v,k){
      if(payload[k]!==undefined) payload[k]=[].concat(payload[k],v);
      else payload[k]=v;
    });
    payload.userAgent=navigator.userAgent;
    payload.submittedAt=new Date().toISOString();

    setSubmitting(true); showLoading(true);

    fetch("/api/submit",{
      method:"POST",
      headers:{ "content-type":"application/json" },
      body:JSON.stringify(payload)
    })
    .then(async function(res){
      if(res.ok) return {ok:true};
      var txt=""; try{ txt=await res.text(); }catch(e){}
      throw new Error("HTTP "+res.status+(txt?(": "+txt):""));
    })
    .then(function(){
      thankyou.style.display="block";
      setTimeout(function(){ window.location.href="thankyou.html"; }, 300);
    })
    .catch(function(err){
      // 即使格式異常也可選擇前往完成頁，避免「成功寄信但前端報錯」
      if (confirm("送出可能成功，但回應格式異常。\n要前往完成頁嗎？\n\n詳細："+(err&&err.message?err.message:err))) {
        window.location.href="thankyou.html";
        return;
      }
      alert("送出失敗，請稍後再試。\n原因："+(err&&err.message?err.message:err));
    })
    .finally(function(){ setSubmitting(false); showLoading(false); });
  },{once:true});
})();
</script>
</body>
</html>
